--- 
before_install: 
  - "sudo apt-get install -y xmlstarlet"
  - "SPOON_MAVEN_PLUGIN_VERSION=`xmlstarlet sel -t -v '/_:project/_:version' pom.xml`"
git: 
  depth: 1
install: true
jdk: 
  - openjdk8
jobs: 
  include: 
    - 
      script: 
        - "cd src/test/projects/processors"
        - "mvn install -DskipTests"
        - "cd ../../../.."
      stage: installProcessor
    - 
      script: 
        - "mvn install -DskipTests"
      stage: installProject
    - 
      script: 
        - "cd src/test/projects/$projectName"
        - "xmlstarlet edit -L --update '/_:project/_:build/_:plugins/_:plugin/_:version' --value $SPOON_MAVEN_PLUGIN_VERSION pom.xml"
        - "mvn package"
        - "mvn clean"
        - "cd ../../../.."
      stage: testProjects
language: java
projectName: 
  - hello-world-with-processor
  - javacc-generate
  - hello-world-with-test
script: 
  - "cd src/test/projects/processors"
  - "mvn install -DskipTests"
  - "cd ../../../.."
  - "mvn install"
sudo: required
